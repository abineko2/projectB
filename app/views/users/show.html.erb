<%=provide(:title,"#{@user.name}") %>

<div style="margin-top:10px;margin-left:15%;width:70%;">
    <table class="table table-bordered">
    <tr>
        <td>
            <%=link_to "←",user_path(id:@user.id,params:{first_day:@first_day.prev_month}),class:"btn btn-primary" %>
            &emsp;<%=@first_day.to_s(:hour_month) %>&emsp;
             時間管理表
            &emsp; 
            <%=link_to "→",user_path(id:@user.id,params:{first_day:@first_day.next_month}),class:"btn btn-primary" %> 
        </td>
        <td><%="指定勤務時間   #{time_format(@user.appoint_time)}" %></td>
        <td colspan="3"><%="基本時間   #{time_format(@user.basic_time)}" %></td>
        <td colspan="3">初日&emsp;<%=@first_day.to_s(:date2) %></td>
    </tr>
    <tr>
        <td>所属 : <%=@user.belongs.present? ? "#{@user.belongs}" : "無所属"  %></td>
        <td><%="氏名 : #{@user.name}" %></td>
        <td>コード</td>
        <td></td>
        <td>出勤日数&emsp;<%="#{@count}日" %></td>
        <td>締め&emsp;<%=@last_day.to_s(:date2) %></td>
    </tr>
</table>
<div>
    <%=link_to "勤怠を編集",edit_attendances_path(@user,@first_day),class:"btn btn-default" %>
</div>
</div>
<div style="margin-top:10px;margin-left:15%;width:70%;">
    <table class="table table-bordered table-condensed table-striped ">
        <thead>
            <tr>
                <th rowspan="2">日付</th>
                <th rowspan="2">曜日</th>
                <th colspan="3">出勤時間</th>
                <th colspan="3">退勤時間</th>
                <th rowspan="2">在社時間</th>
                <th rowspan="2">備考</th>
            </tr>
            <tr>
                <th>時</th>
                <th>分</th>
                <th></th>
                
                <th>時</th>
                <th>分</th>
                <th></th>
                
            </tr>
        </thead>
        <tbody>
            <% @dates.each do |day| %>
              <tr>
                  <td><%=day.worked_on.to_s(:date) %></td>
                      <% week=%w(日 月 火 水 木 金 土)[day.worked_on.wday] %>
                      <% if week["土"] %>
                         <td style="color:blue"><%=week["土"] %></td>
                　　　<% elsif week["日"] %>
                         <td style="color:red"><%=week["日"] %></td>
                      <% else %>
                         <td><%=week %></td>
                      <% end %>

                  
                  <td><%=day.start_at.to_s(:hour) if day.start_at.present? %></td>
                  <td><%=day.start_at.to_s(:min) if day.start_at.present? %></td>
                  <td>
                      <% if day.worked_on==Date.today && day.start_at==nil %>
                        <%=button_to "出勤",user_attendances_path(@user),class:"btn btn-primary btn-block" %>
                      <% end %>
                  </td>
                  <td><%=day.finished_at.to_s(:hour) if day.finished_at.present? %></td>
                  <td><%=day.finished_at.to_s(:min) if day.finished_at.present? %></td>
                  <td>
                      <% if day.worked_on==Date.today && day.start_at.present? && day.finished_at==nil %>
                        <%=button_to "退勤",user_attendances_path(@user),class:"btn btn-primary btn-block" %>
                      <% end %>
                  </td>
                  <td>
                      <% if day.start_at.present? && day.finished_at.present? %>
                        <%=working_time(day.finished_at,day.start_at) %>
                        <% num=(day.finished_at-day.start_at).to_i %>
                        <% @total=@total.to_i+num %>
                      <% end %>
                  </td>
                  <td><%=day.note %></td>
              </tr>
            <% end %>
        </tbody>
        <tfoot>
            <tr>
                <td colspan="2"><%=time_format(@user.basic_time).to_f*@count %></td>
                <td colspan="6"></td>
                <td><%= working_time_sum(@total) unless @total.nil? %></td>
                <td>所属長承認</td>
            </tr>
        </tfoot>
    </table>
</div>
